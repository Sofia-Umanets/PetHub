{% extends '_base.html' %}
{% load static %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∏—Ç–æ–º—Ü–∞{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pets.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/pet_form.js' %}"></script>
{% endblock %}

{% block content %}
<h1>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∏—Ç–æ–º—Ü–∞</h1>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
{% endif %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="card">
        <label>–ò–º—è:</label>
        <input type="text" name="name" value="{{ pet.name }}" required>

        <label>–¢–∏–ø –∂–∏–≤–æ—Ç–Ω–æ–≥–æ:</label>
        <select id="pet_type" name="pet_type" required onchange="toggleCustomPetType()">
            <option value="dog" {% if pet.pet_type == 'dog' %}selected{% endif %}>üê∂ –°–æ–±–∞–∫–∞</option>
            <option value="cat" {% if pet.pet_type == 'cat' %}selected{% endif %}>üê± –ö–æ—à–∫–∞</option>
            <option value="bird" {% if pet.pet_type == 'bird' %}selected{% endif %}>üê¶ –ü—Ç–∏—Ü–∞</option>
            <option value="rodent" {% if pet.pet_type == 'rodent' %}selected{% endif %}>üêπ –ì—Ä—ã–∑—É–Ω</option>
            <option value="rabbit" {% if pet.pet_type == 'rabbit' %}selected{% endif %}>üê∞ –ö—Ä–æ–ª–∏–∫</option>
            <option value="reptile" {% if pet.pet_type == 'reptile' %}selected{% endif %}>üêç –†–µ–ø—Ç–∏–ª–∏—è</option>
            <option value="fish" {% if pet.pet_type == 'fish' %}selected{% endif %}>üê† –†—ã–±–∫–∞</option>
            <option value="other" {% if pet.pet_type == 'other' %}selected{% endif %}>‚ùì –î—Ä—É–≥–æ–µ (—É–∫–∞–∑–∞—Ç—å)</option>
        </select>

        <div id="custom_pet_type_group" style="display: {% if pet.pet_type == 'other' %}block{% else %}none{% endif %};">
            <label>–£–∫–∞–∂–∏—Ç–µ —Ç–∏–ø –∂–∏–≤–æ—Ç–Ω–æ–≥–æ:</label>
            <input type="text" id="custom_pet_type" name="custom_pet_type" 
                   value="{{ pet.custom_pet_type|default:'' }}"
                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ö–æ—Ä—ë–∫, —á–µ—Ä–µ–ø–∞—Ö–∞, –∏–≥—É–∞–Ω–∞...">
        </div>

        <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
        <input type="date" 
        name="birthday" 
        value="{{ pet.birthday|date:'Y-m-d' }}" 
        required 
        max="{% now 'Y-m-d' %}"
        oninvalid="this.setCustomValidity('–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º')"
        oninput="this.setCustomValidity('')">

        <label>–í–µ—Å (–≤ –∫–≥):</label>
        <input type="number" name="weight" step="0.1" value="{{ pet.weight }}">

        <label>–ü–æ—Ä–æ–¥–∞:</label>
        <input type="text" name="breed" value="{{ pet.breed }}">

        <label>–ü–æ–ª:</label>
        <select name="gender">
            <option value="" {% if not pet.gender %}selected{% endif %}>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
            <option value="M" {% if pet.gender == 'M' %}selected{% endif %}>–ú–∞–ª—å—á–∏–∫</option>
            <option value="F" {% if pet.gender == 'F' %}selected{% endif %}>–î–µ–≤–æ—á–∫–∞</option>
        </select>

        <label>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</label>
        <textarea name="features" placeholder="–£–∫–∞–∂–∏—Ç–µ –∞–ª–ª–µ—Ä–≥–∏–∏, —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è –∏ –¥—Ä—É–≥–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–∏—Ç–æ–º—Ü–∞" 
        rows="4" style="width: 100%; word-wrap: break-word; white-space: pre-wrap;">{{ pet.features|default_if_none:"" }}</textarea>

        <label>–§–æ—Ç–æ:</label>
        {% if pet.photo %}
            <img src="{{ pet.photo.url }}" alt="–§–æ—Ç–æ –ø–∏—Ç–æ–º—Ü–∞" class="pet-photo-preview">
        {% endif %}
        <input type="file" name="photo">

        <button type="submit" class="btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <a href="{% url 'pets:detail' pet.id %}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
    </div>
</form>


{% endblock %}
